## Canny边缘检测

Canny 边缘检测是一种使用多级边缘检测算法检测边缘的方法。
Canny()边缘检测步骤
Canny 边缘检测分为如下几个步骤：

步骤 1：去噪。噪声会影响边缘检测的准确性，因此首先要将噪声过滤掉。

步骤 2：计算梯度的幅度与方向。

步骤 3：非极大值抑制，即适当地让边缘“变瘦”。

步骤 4：确定边缘。使用双阈值算法确定最终的边缘信息。
下面对上述步骤分别进行简单的介绍。

## 1. 应用高斯滤波去除图像噪声

由于图像边缘非常容易受到噪声的干扰，因此为了避免检测到错误的边缘信息，通常需要对图像进行滤波以去除噪声。滤波的目的是平滑一些纹理较弱的非边缘区域，以便得到更准确的边缘。在实际处理过程中，通常采用高斯滤波去除图像中的噪声。
在滤波过程中，我们通过滤波器对像素点周围的像素计算加权平均值，获取最终滤波结果。滤波器的大小也是可变的，高斯核的大小对于边缘检测的效果具有很重要的作用。滤波器
的核越大，边缘信息对于噪声的敏感度就越低。不过，核越大，边缘检测的定位错误也会随之增加。通常来说，一个 5×5 的核能够满足大多数的情况。

## 2. 计算梯度

梯度的方向与边缘的方向是垂直的。
边缘检测算子返回水平方向的Gx和垂直方向的Gy。梯度的幅度𝐺和方向𝛩（用角度值表示）为：
$G=\sqrt{G_x^2+G_y^2}$
$\Theta=\operatorname{atan} 2\left(G_y, G_x\right)$
式中，atan2(•)表示具有两个参数的 arctan 函数。
梯度的方向总是与边缘垂直的，通常就近取值为水平（左、右）、垂直（上、下）、对角线（右上、左上、左下、右下）等 8 个不同的方向。
因此，在计算梯度时，我们会得到梯度的幅度和角度（代表梯度的方向）两个值。
图 10-2 展示了梯度的表示法。其中，每一个梯度包含幅度和角度两个不同的值。为了方便观察，这里使用了可视化表示方法。例如，左上角顶点的值“2↑”实际上表示的是一个二元数对“(2, 90)”，表示梯度的幅度为 2，角度为 90°。


## 3. 非极大值抑制

在获得了梯度的幅度和方向后，遍历图像中的像素点，去除所有非边缘的点。在具体实现时，逐一遍历像素点，判断当前像素点是否是周围像素点中具有相同梯度方向的最大值，并根据判断结果决定是否抑制该点。通过以上描述可知，该步骤是边缘细化的过程。针对每一个像
素点：
如果该点是正/负梯度方向上的局部最大值，则保留该点。
如果不是，则抑制该点（归零）

## 4. 应用双阈值确定边缘

完成上述步骤后，图像内的强边缘已经在当前获取的边缘图像内。但是，一些虚边缘可能也在边缘图像内。这些虚边缘可能是真实图像产生的，也可能是由于噪声所产生的。对于后者，必须将其剔除。
设置两个阈值，其中一个为高阈值 maxVal，另一个为低阈值 minVal。根据当前边缘像素的梯度值（指的是梯度幅度，下同）与这两个阈值之间的关系，判断边缘的属性。具体步骤为：

（1）如果当前边缘像素的梯度值大于或等于 maxVal，则将当前边缘像素标记为强边缘。

（2）如果当前边缘像素的梯度值介于 maxVal 与 minVal 之间，则将当前边缘像素标记为虚
边缘（需要保留）。

（3）如果当前边缘像素的梯度值小于或等于 minVal，则抑制当前边缘像素。

在上述过程中，我们得到了虚边缘，需要对其做进一步处理。一般通过判断虚边缘与强边缘是否连接，来确定虚边缘到底属于哪种情况。通常情况下，如果一个虚边缘：
与强边缘连接，则将该边缘处理为边缘。
与强边缘无连接，则该边缘为弱边缘，将其抑制。

## Canny 函数及使用

OpenCV 提供了函数 cv2.Canny()来实现 Canny 边缘检测，其语法形式如下：

edges = cv.Canny( image, threshold1, threshold2[, apertureSize[, L2gradient]])
其中：

edges 为计算得到的边缘图像。

image 为 8 位输入图像。

threshold1 表示处理过程中的第一个阈值。

threshold2 表示处理过程中的第二个阈值。

apertureSize 表示 Sobel 算子的孔径大小。

L2gradient 为计算图像梯度幅度（gradient magnitude）的标识。其默认值为 False。如果为 True，则使用更精确的 L2 范数进行计算（即两个方向的导数的平方和再开方），否则使用 L1 范数（直接将两个方向导数的绝对值相加）。
